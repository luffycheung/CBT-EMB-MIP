# 实验三. 八段数码管控制实验

----------
##  实验目的
- 了解多核心平台底板设备电路结构;
- 掌握Android Studio下编写NDK代码，实现数码管的控制;

##  实验环境
* 硬件：CBT-EMB-MIP 实验平台,PC机,mini USB数据线;
* 软件： Android Studio 2.2 或更高版本， Android Plugin for Gradle 版本 2.2.0 或更高版本，CMake;

##  实验内容
- 编写NDK程序，实现对板载2路八段数码管的控制。


##  实验原理

### 主板电路原理图

![数码管](/chapter5/experiment03/Nixie.png)   

**图4.1** 原理图   

&emsp;&emsp;首先为了在单独的一位数字上显示出我们想要的数字，要根据数码管每一位所对应的引脚输入正确的值。一个数码管数字一共由7个长直型的发光二极管组成，分别被以”A”-“G”的英文字母编号，右下角的小数点用“DP”编号。点亮一个数码管的电路跟点亮一个普通发光二极管没什么两样，就是在高低电压之间让数码管和一个分压电阻串联，因此想要点亮带小数点的一个十进制数，需要由8个并联的发光二极管电路来完成。

&emsp;&emsp;那么如果想同时点亮两个数字，是不是需要8X2=16个并联电路呢？
&emsp;&emsp;实际上一般的数码管都不使用如此复杂的电路，而是利用人眼的“视觉暂留”效应，通过快速切换数码管的显示，达到多位数字的显示目的。这时，只需要每个数字的阳极或阴极列作为公共控制引脚，就可以控制每个数字的显示。   

**图4.1**中的内部电路是共阴极数码管的电路，每8组数码管有一个公共阴极，同一时刻，只允许一个数字发亮，当两个数字中快速切换，便可形成多位数字同时显示的效果。


### 驱动实现

&emsp;&emsp;每个数字当我们想让他亮的时候，将对应的阴极置为**低电平**即可。可得出下列二维数组：
```
unsigned char table[10][8] =
{
    {1, 1,  0,  0,  0,  0,  0,  0},         //0 --> 0xc0
    {1, 1,  1,  1,  1,  0,  0,  1},         //1 --> 0xf9
    {1, 0,  1,  0,  0,  1,  0,  0},         //2 --> 0xa4
    {1, 0,  1,  1,  0,  0,  0,  0},         //3 --> 0xb0
    {1, 0,  0,  1,  1,  0,  0,  1},         //4 --> 0x99
    {1, 0,  0,  1,  0,  0,  1,  0},         //5 --> 0x92
    {1, 0,  0,  0,  0,  0,  1,  0},         //6 --> 0x82
    {1, 1,  1,  1,  1,  0,  0,  0},         //7 --> 0xf8
    {1, 0,  0,  0,  0,  0,  0,  0},         //8 --> 0x80
    {1, 0,  0,  1,  0,  0,  0,  0}          //9 --> 0x90
};
```
   
&emsp;&emsp;以上的代码分别对应了0-9的数字在数码管上的显示IO管脚电平，按照顺时针方向，从8字顶端开始为ABCDEFG，DP，而代码中从高到低对应DP,GFEDCBA。

&emsp;&emsp;数码管底层驱动为字符驱动，采用动态编译(`4412_digitron.ko`)方式,加载后设备名为`/dev/digitron`。   

### 接口函数

```c
int open(const char *pathname, int flags); //同实验二LED
int close(int fildes);//同实验二LED
int ioctl(int fd, int number); //number为上述二维数组中对应的十六进制数值
```

这样数码管设备`/dev/digitron`通过`ioctl`赋值既可显示相应数字。   
***示例***：
```
//显示`0`(0xc0)
ioctl(fd, 0xc0);
```
